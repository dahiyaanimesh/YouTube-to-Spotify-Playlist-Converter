{% extends "base.html" %}

{% block title %}Conversion Results - YouTube to Spotify Converter{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <!-- Success Header -->
        <div class="text-center mb-5">
            <div class="mb-4">
                <i class="fas fa-check-circle fa-5x text-success"></i>
            </div>
            <h1 class="display-5 fw-bold mb-3 text-white">Conversion Complete!</h1>
            <p class="lead text-white">Your YouTube playlist has been successfully converted to Spotify.</p>
        </div>

        <!-- Results Card -->
        <div class="card shadow-lg mb-4">
            <div class="card-header bg-success text-white text-center py-3">
                <h4 class="mb-0 text-white">
                    <i class="fab fa-spotify me-2"></i>
                    {{ results.playlist_name }}
                </h4>
            </div>
            <div class="card-body">
                <!-- Stats Row -->
                <div class="row text-center mb-4">
                    <div class="col-md-3 mb-3">
                        <div class="stat-box">
                            <h3 class="text-primary mb-1">{{ results.total_videos }}</h3>
                            <small class="text-dark fw-semibold">TOTAL VIDEOS</small>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="stat-box">
                            <h3 class="text-success mb-1">{{ results.found_tracks }}</h3>
                            <small class="text-dark fw-semibold">FOUND ON SPOTIFY</small>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="stat-box">
                            <h3 class="text-warning mb-1">{{ results.failed_tracks|length }}</h3>
                            <small class="text-dark fw-semibold">NOT FOUND</small>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="stat-box">
                            <h3 class="text-success mb-1">{{ "%.1f"|format(results.success_rate) }}%</h3>
                            <small class="text-dark fw-semibold">SUCCESS RATE</small>
                        </div>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="mb-4">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="fw-bold text-dark">Conversion Progress</span>
                        <span class="text-secondary fw-medium">{{ results.found_tracks }}/{{ results.total_videos }} tracks</span>
                    </div>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar bg-success" 
                             role="progressbar" 
                             data-success-rate="{{ results.success_rate|round(1) }}"
                             aria-valuenow="{{ results.success_rate|round(1) }}" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                            <span class="text-white fw-bold">{{ "%.1f"|format(results.success_rate) }}%</span>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="d-grid gap-2 d-md-flex justify-content-md-center mb-4">
                    <a href="{{ results.playlist_url }}" target="_blank" class="btn btn-success btn-lg">
                        <i class="fab fa-spotify me-2"></i>
                        OPEN IN SPOTIFY
                    </a>
                    <a href="{{ url_for('index') }}" class="btn btn-outline-primary btn-lg">
                        <i class="fas fa-plus me-2"></i>
                        CONVERT ANOTHER
                    </a>
                </div>

                <!-- Success Message -->
                {% if results.success_rate >= 80 %}
                    <div class="alert alert-success d-flex align-items-center" role="alert">
                        <i class="fas fa-thumbs-up me-3 fa-lg"></i>
                        <div>
                            <strong>Excellent!</strong> We found most of your tracks on Spotify. Your playlist is ready to enjoy!
                        </div>
                    </div>
                {% elif results.success_rate >= 60 %}
                    <div class="alert alert-warning d-flex align-items-center" role="alert">
                        <i class="fas fa-info-circle me-3 fa-lg"></i>
                        <div>
                            <strong>Good match!</strong> We found a good portion of your tracks. Some tracks might not be available on Spotify.
                        </div>
                    </div>
                {% else %}
                    <div class="alert alert-info d-flex align-items-center" role="alert">
                        <i class="fas fa-lightbulb me-3 fa-lg"></i>
                        <div>
                            <strong>Partial match.</strong> Some tracks weren't found. This might be due to different naming or availability on Spotify.
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Failed Tracks -->
        {% if results.failed_tracks %}
        <div class="card shadow-lg mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <button class="btn btn-link text-decoration-none p-0 text-dark fw-bold w-100 text-start" type="button" 
                            data-bs-toggle="collapse" data-bs-target="#failedTracks" 
                            aria-expanded="false" aria-controls="failedTracks">
                        <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                        Tracks Not Found on Spotify ({{ results.failed_tracks|length }})
                        <i class="fas fa-chevron-down ms-2 float-end"></i>
                    </button>
                </h5>
            </div>
            <div class="collapse" id="failedTracks">
                <div class="card-body">
                    <p class="text-dark mb-3">
                        These tracks couldn't be found on Spotify. They might be:
                    </p>
                    <ul class="text-dark mb-3">
                        <li>Remixes, covers, or unofficial versions</li>
                        <li>Region-restricted content</li>
                        <li>Not available on Spotify</li>
                        <li>Titled differently on Spotify</li>
                    </ul>
                    
                    <div class="failed-tracks-list bg-light p-3 rounded border" style="max-height: 300px; overflow-y: auto;">
                        {% for track in results.failed_tracks %}
                            <div class="border-bottom py-2 last:border-0">
                                <i class="fas fa-times text-danger me-2"></i>
                                <span class="text-dark">{{ track }}</span>
                            </div>
                        {% endfor %}
                    </div>
                    
                    <div class="mt-3">
                        <small class="text-secondary">
                            <i class="fas fa-lightbulb me-1"></i>
                            Tip: You can manually search for these tracks on Spotify and add them to your playlist.
                        </small>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Tips Section -->
        <div class="card shadow-lg bg-dark text-white">
            <div class="card-body">
                <h6 class="card-title text-white">
                    <i class="fas fa-lightbulb text-warning me-2"></i>
                    What's next?
                </h6>
                <ul class="mb-0 text-white">
                    <li class="mb-2">Your playlist is now available in your Spotify library</li>
                    <li class="mb-2">You can edit, reorder, or add more tracks as needed</li>
                    <li class="mb-2">Share your playlist with friends and family</li>
                    <li class="mb-2">Consider following artists you discovered</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Hidden data for JavaScript -->
<div id="resultData" data-success-rate="{{ results.success_rate|round(1) }}" style="display: none;"></div>
{% endblock %}

{% block scripts %}
<script>
// Auto-collapse failed tracks if success rate is high
document.addEventListener('DOMContentLoaded', function() {
    const resultData = document.getElementById('resultData');
    if (resultData) {
        const successRate = parseFloat(resultData.dataset.successRate);
        if (successRate >= 90) {
            // Keep collapsed for high success rates
            const failedTracksCollapse = document.getElementById('failedTracks');
            if (failedTracksCollapse) {
                failedTracksCollapse.classList.remove('show');
            }
        }
    }
    
    // Set progress bar width dynamically
    const progressBar = document.querySelector('.progress-bar[data-success-rate]');
    if (progressBar) {
        const successRate = progressBar.dataset.successRate;
        progressBar.style.width = successRate + '%';
        
        // Animate the progress bar
        progressBar.style.width = '0%';
        setTimeout(() => {
            progressBar.style.transition = 'width 1.5s ease-in-out';
            progressBar.style.width = successRate + '%';
        }, 500);
    }
});
</script>
{% endblock %} 